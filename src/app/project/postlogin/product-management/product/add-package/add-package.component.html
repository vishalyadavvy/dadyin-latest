<div class="my-2">
  <div *ngIf="packages.controls?.length == 0" class="bg-light b-round b-dark d-flex py-2 justify-content-end">
    <dadyin-button class="text-right mx-2" (clicked)="addPackage()" label="Add New Package" [theme]="'primary'">
    </dadyin-button>
  </div>
  <ng-container *ngFor="
      let packageForm of packages.controls | sortFormArray;
      let i = index;
      trackBy: trackByFn
    ">
    <ng-container [formGroup]="packageForm">
      <mat-expansion-panel [expanded]="packageForm.get('isSku').value" class="panel-no-padding attr-b" #expansionPanel1>
        <mat-expansion-panel-header (click)="expandPanel(expansionPanel1, $event)">
          <mat-panel-description>
            <div class="toolbar px-3 height-40 d-flex align-items-center p-0 w-100 font-size-12"
              style="background: none !important">
              <div class="d-flex align-items-center">
                <div class="radio-selection m-0">
                  <input type="checkbox" name="isSku" (change)="confirmChange($event, i)" formControlName="isSku"
                    id="sku" />
                  <label for="sku" class="text-black">SKU</label>
                </div>
                <div class="title-text width-80 text-start" style="margin-right: 1rem" *ngIf="
                    hidePackageExpenseAndAttributes(
                      packageForm.get('packageType').value
                    )
                  ">
                  Package {{ i }} :
                </div>

                <div class="title-text width-80 text-start" style="margin-right: 1rem" *ngIf="
                    !hidePackageExpenseAndAttributes(
                      packageForm.get('packageType').value
                    )
                  ">
                  Product Unit :
                </div>

                <div class="attribute-group" *ngIf="
                    hidePackageExpenseAndAttributes(
                      packageForm.get('packageType').value
                    )
                  ">
                  <select class="title-text b-round h-30" style="width: 165px"
                    (change)="renderPackageAttributes($event, i)" name="packageType" formControlName="packageType">
                    <option disabled selected value="null">
                      Select Package Type
                    </option>
                    <option *ngFor="
                        let item of getFilteredPackageTypes(
                          apiService.packageTypes,
                          packageForm.get('packageType').value
                        )
                      " [value]="item">
                      {{ item }}
                    </option>
                  </select>
                </div>
                <div class="attribute-group" *ngIf="
                    !hidePackageExpenseAndAttributes(
                      packageForm.get('packageType').value
                    )
                  ">
                  <div class="font-size-14 b-round bg-white p-1 text-uppercase text-left" style="
                      width: 165px;
                      min-height: 30px;
                      text-overflow: ellipsis;
                      overflow: hidden;
                      white-space: nowrap;
                      align-content: end;
                    " *ngIf="
                      !hidePackageExpenseAndAttributes(
                        packageForm.get('packageType').value
                      )
                    ">
                    {{ productForm.get("unitName").value }}
                  </div>
                </div>
                <!-- <div class="radio-selection">
                  <input type="checkbox" id="packageforsale" />
                  <label for="packageforsale">Package for Sale</label>
                </div> -->
              </div>
              <div class="title-text unit-value p-1 position-relative border-l-light" container="body" placement="top"
                [ngbTooltip]="priceinfo">
                <span class="px-3 text-light">
                  Considered Price :
                  <span class="fw-600 text-black">
                    {{
                    packageForm.get("costPerSku").get("attributeValue").value
                    | numberFormatter : 3
                    }}
                    {{
                    packageForm.get("costPerSku").get("userConversionUom").value
                    }}</span>
                </span>

                <ng-template #priceinfo>
                  <section>
                    <p>
                      Qty: {{ packageForm.get("numberOfSkus").value }} SKU's
                    </p>
                    <p>
                      WT:
                      {{
                      packageForm.get("weight").get("attributeValue").value
                      | numberFormatter : 3
                      }}
                      {{
                      packageForm.get("weight").get("userConversionUom").value
                      }}
                      /SKU
                    </p>
                  </section>
                </ng-template>
              </div>
              <div class="d-flex justify-content-end align-items-center">
                <div class="title-text unit-value position-relative border-l-light">
                  <span class="px-2 text-light">
                    WT/Unit :
                    <span class="fw-600 text-black">
                      {{
                      packageForm.get("weight").get("attributeValue").value
                      | numberFormatter : 3
                      }}</span>
                  </span>
                  <select class="bg-transparent title-text" (change)="getCalculatedValues()" [formControl]="
                    packageForm.get('weight').get('userConversionUom')
                  ">
                    <option *ngFor="let uom of uomService?.availableNetWeightUoms" [value]="uom.description">
                      {{ uom.description }}
                    </option>
                  </select>
                </div>
                <div class="title-text unit-value position-relative border-l-light">
                  <span class="px-2 text-light">
                    COST/ {{ packageForm.get("packageType").value }} :
                    <span class="fw-600 text-black">
                      {{
                      packageForm.get("cost").get("attributeValue").value
                      | numberFormatter : 3
                      }}</span>
                  </span>
                  <select class="bg-transparent title-text" (change)="getCalculatedValues()" [formControl]="
                    packageForm.get('cost').get('userConversionUom')
                  ">
                    <option *ngFor="let uom of uomService?.availableCostUoms" [value]="uom.description">
                      {{ uom.description }}
                    </option>
                  </select>
                </div>
              </div>

              <div>
                <!--  <dadyin-button
                  [theme]="'borderless-danger'"
                  type="icon"
                  [typeval]="'delete_outline'"
                  (clicked)="removePackage(i)"
                >
                </dadyin-button> -->
                <dadyin-button (clicked)="removePackage(i)" matTooltip="Delete" [typeval]="'assets/nicons/delete.png'"
                  [theme]="'borderless-primary'" type="image">
                </dadyin-button>
              </div>
            </div>
          </mat-panel-description>
          <!-- <div class="width-40" *ngIf="i < 1">
            <mat-icon></mat-icon>
          </div> -->
        </mat-expansion-panel-header>
        <div class="mt-1 b-all" *ngIf="
            hidePackageExpenseAndAttributes(
              packageForm.get('packageType').value
            ) && isPackageAttributes.value == true
          ">
          <div class="toolbar px-3 bg-light grid-7 height-40 font-size-14 border-b-light">
            <div class="text-left title-text text-light d-flex align-items-center">

              {{ packageForm.get("parentPackageType").value }} /
              {{ packageForm.get("packageType").value }} Attributes

              <mat-icon (click)="
                  toggleGlobalAttributes(
                    getPackageAttributeValues(i).controls,
                    packageForm.get('showPackageAttributeValues')
                  )
                " [ngClass]="{
                  disabled: !packageForm.get('showPackageAttributeValues')
                }" class="primary bg-light title-text public_icon mx-2">
                {{
                packageForm.get("showPackageAttributeValues").value
                ? "visibility"
                : "visibility_off"
                }}
              </mat-icon>
              <div class="mx-2" style="border-left: solid 1px; padding-left: 10px">
                <a target="_blank" [routerLink]="
                    '/home/product-management/product-template/edit/' +
                    this.apiService?.productTemplateForCalculation?.value?.id
                  ">
                  {{
                  this.apiService?.productTemplateForCalculation?.value
                  ?.templateName
                  }}
                  <span *ngIf="
                      this.apiService?.productTemplateForCalculation?.value
                        ?.productTemplateCalculator?.description
                    ">({{
                    this.apiService?.productTemplateForCalculation?.value
                    ?.productTemplateCalculator?.description
                    }})
                  </span>
                </a>
              </div>

              <mat-icon (click)="syncProductTemplate(i)" class="primary public_icon bg-light title-text">
                sync
              </mat-icon>
            </div>
            <div class="options d-flex">
              <div class="width-perc-100">
                <!-- <select class="width-perc-100" id="pAttribute" [formControl]="pAttribute"
                  placeholder="Select Existing Attribute to Add">
                  <option value="" disabled>Select Existing Attribute to Add</option>
                  <ng-container *ngFor="let item of this.apiService.allAttributes | SortNamePipe:'description'">
                    <option [ngValue]="item">{{item.description}}</option>
                  </ng-container>
                </select> -->
                <dadyin-searchable-select [marginBottom]="false" placeholder="Select existing attribute to add"
                  [control]="pAttribute" [fullItems]="apiService.allAttributes" [bindValue]="null"
                  bindLabel="description"></dadyin-searchable-select>
              </div>
              <div>
                <select id="pAttribute" class="width-perc-100 b-round width-100 h-30 mx-1" [formControl]="colSpace">
                  <option value="" selected>Field Space</option>
                  <option value="25">25</option>
                  <option value="50">50</option>
                  <option value="75">75</option>
                  <option value="100">100</option>
                </select>
              </div>
              <!-- <dadyin-button
                class="mx-2"
                [isDisabled]="!pAttribute?.value || !colSpace.value"
                (clicked)="
                  addExistingAttribute(i, packageForm.get('packageType').value)
                "
                label="Add"
                [theme]="'primary'"
              >
              </dadyin-button> -->
              <dadyin-button [isDisabled]="!pAttribute?.value || !colSpace.value" (clicked)="
                  addExistingAttribute(i, packageForm.get('packageType').value)
                " [typeval]="'assets/nicons/add-white.png'" [theme]="'borderless-primary'"
                type="image"></dadyin-button>
              <dadyin-button (clicked)="openAttributeDialog(i)" [theme]="'borderless-primary'" class="sort-btn bg-white"
                type="icon" [typeval]="'sort'">
              </dadyin-button>
            </div>
          </div>
          <div class="row py-3">

            <div class="col-9">
              <div class="row package-attributes" *ngIf="getPackageAttributeValues(i).controls?.length > 0">
                <ng-container [formGroup]="item" *ngFor="
                            let item of getPackageAttributeValues(i).controls
                              | sortFormArray;
                            let k = index;
                            trackBy: trackByFn
                          ">
                  <ng-container *ngIf="
                              !labelTypeAttributeIds[i]?.includes(
                                item.get('attributeId').value
                              )
                            ">
                    <ng-container *ngIf="
                                !['Toggle', 'Dropdown', 'Label'].includes(
                                  getAttributeTypeObjectById(
                                    this.getAttributeObjectById(
                                      item?.get('attributeId').value
                                    )?.attributeTypeId
                                  )?.description
                                )
                              ">
                      <div class="d-flex align-items-baseline" [ngClass]="{
                                  'width-perc-25': item?.get('colSpace').value == 25,
                                  'width-perc-50': item?.get('colSpace').value == 50,
                                  'width-perc-75': item?.get('colSpace').value == 75,
                                  'width-perc-100': item?.get('colSpace').value == 100
                                }">
                        <div class="attribute one attr-b mb-0">
                          <label for="">
                            {{
                            this.getAttributeObjectById(
                            item?.get("attributeId").value
                            )?.description
                            }}</label>
                          <div class="attribute-input">
                            <!-- <mat-icon class="more_vert">more_vert</mat-icon> -->
                            <input (change)="changeValue(item)" type="text" formControlName="attributeValue"
                              placeholder="Enter your value" />
                            <mat-icon *ngIf="item?.get('isUserInput').value" (click)="toggleLock(item, false)"
                              class="lock">
                              lock
                            </mat-icon>
                            <mat-icon *ngIf="!item?.get('isUserInput').value" (click)="toggleLock(item, true)"
                              class="lock_open">
                              lock_open
                            </mat-icon>
                            <ng-container *ngIf="
                                        getAttributeTypeObjectById(
                                          this.getAttributeObjectById(
                                            item?.get('attributeId').value
                                          )?.attributeTypeId
                                        )?.availableUOMs?.length > 0
                                      ">
                              <select tabindex="-1" *ngIf="
                                          !['Number', 'String'].includes(
                                            getAttributeTypeObjectById(
                                              getAttributeObjectById(
                                                item?.get('attributeId').value
                                              )?.attributeTypeId
                                            ).description
                                          )
                                        " (change)="changeValue()" formControlName="userConversionUom"
                                id="userConversionUom">
                                <option [value]="uom.description" *ngFor="
                                            let uom of getAttributeTypeObjectById(
                                              this.getAttributeObjectById(
                                                item?.get('attributeId').value
                                              )?.attributeTypeId,
                                              item?.get('userConversionUom')
                                            ).availableUOMs
                                          ">
                                  {{ uom?.description }}
                                </option>
                              </select>
                            </ng-container>

                            <ng-container *ngIf="
                                        ['Number', 'String'].includes(
                                          getAttributeTypeObjectById(
                                            getAttributeObjectById(
                                              item?.get('attributeId').value
                                            )?.attributeTypeId
                                          ).description
                                        )
                                      ">
                              <div class="uom-label">
                                {{ item?.get("userConversionUom").value ?? "" }}
                              </div>
                            </ng-container>
                          </div>
                          <!--   <i class="cancel_outline_new material-icon" (click)="removePackageAttribute(i, k)">
                            cancel_outline
                          </i> -->

                        </div>
                        <dadyin-button (click)="removePackageAttribute(i, k)" matTooltip="Delete"
                          [typeval]="'assets/nicons/delete.png'" [theme]="'borderless-primary'" type="image">
                        </dadyin-button>
                      </div>
                    </ng-container>
                    <ng-container *ngIf="
                                ['Toggle'].includes(
                                  getAttributeTypeObjectById(
                                    this.getAttributeObjectById(
                                      item?.get('attributeId').value
                                    )?.attributeTypeId
                                  )?.description
                                )
                              ">
                      <div class="d-flex  align-items-start" [ngClass]="{
                                  'width-perc-25': item.get('colSpace').value == 25,
                                  'width-perc-50': item.get('colSpace').value == 50,
                                  'width-perc-75': item.get('colSpace').value == 75,
                                  'width-perc-100': item.get('colSpace').value == 100
                                }">
                        <div class="attribute tabular-sheet attr-b">
                          <div class="attribute-input">
                            <input (change)="changeValue(item)" type="text" [value]="
                                        this.getAttributeObjectById(
                                          item?.get('attributeId').value
                                        )?.description
                                      " readonly />
                            <mat-icon *ngIf="item?.get('isUserInput').value" (click)="toggleLock(item, false)"
                              class="lock">
                              lock
                            </mat-icon>
                            <mat-icon *ngIf="!item?.get('isUserInput').value" (click)="toggleLock(item, true)"
                              class="lock_open">
                              lock_open
                            </mat-icon>
                            <div class="toggle">
                              <button [ngClass]="{
                                          active:
                                            getArray(
                                              item.get('attributeValueExpression').value
                                            )[0]?.selected == true
                                        }" (click)="toggleAttribute(item, 0, i)">
                                {{
                                getArray(
                                item.get("attributeValueExpression").value
                                )[0].choice
                                }}
                              </button>
                              <button [ngClass]="{
                                          active:
                                            getArray(
                                              item.get('attributeValueExpression').value
                                            )[1]?.selected == true
                                        }" (click)="toggleAttribute(item, 1, i)">
                                {{
                                getArray(
                                item.get("attributeValueExpression").value
                                )[1].choice
                                }}
                              </button>
                              <!-- <button >Sheet</button> -->
                            </div>
                          </div>
                          <!--  <i (click)="removePackageAttribute(i, k)" class="cancel_outline_new material-icon">cancel_outline</i> -->

                        </div>
                        <dadyin-button (click)="removePackageAttribute(i, k)" matTooltip="Delete"
                          [typeval]="'assets/nicons/delete.png'" [theme]="'borderless-primary'" type="image">
                        </dadyin-button>
                      </div>
                    </ng-container>

                    <ng-container *ngIf="
                                ['Dropdown'].includes(
                                  getAttributeTypeObjectById(
                                    this.getAttributeObjectById(
                                      item?.get('attributeId').value
                                    )?.attributeTypeId
                                  )?.description
                                )
                              ">
                      <div class="d-flex  align-items-baseline" [ngClass]="{
                                  'width-perc-25': item.get('colSpace').value == 25,
                                  'width-perc-50': item.get('colSpace').value == 50,
                                  'width-perc-75': item.get('colSpace').value == 75,
                                  'width-perc-100': item.get('colSpace').value == 100
                                }">
                        <div class="attribute one attr-b">
                          <label for="">
                            {{
                            this.getAttributeObjectById(
                            item?.get("attributeId").value
                            )?.description
                            }}</label>
                          <div class="attribute-input">
                            <mat-icon (click)="onDragClickAttribute(i)" class="more_vert">more_vert</mat-icon>
                            <select formControlName="attributeValue" (change)="changeValue(item)"
                              class="width-perc-100 bg-white">
                              <option *ngFor="
                                          let opt of getArray(
                                            item.get('attributeValueExpression').value
                                          )
                                        " [value]="opt.choice">
                                {{ opt.choice }}
                              </option>
                            </select>
                          </div>
                          <!--  <i class="cancel_outline_new material-icon" (click)="removePackageAttribute(i, k)">
                            cancel_outline
                          </i> -->

                        </div>
                        <dadyin-button (click)="removePackageAttribute(i, k)" matTooltip="Delete"
                          [typeval]="'assets/nicons/delete.png'" [theme]="'borderless-primary'" type="image">
                        </dadyin-button>
                      </div>
                    </ng-container>

                    <ng-container *ngIf="
                                ['Label'].includes(
                                  getAttributeTypeObjectById(
                                    this.getAttributeObjectById(
                                      item?.get('attributeId').value
                                    )?.attributeTypeId
                                  )?.description
                                )
                              ">
                      <div class="width-perc-100 row b-all mx-auto p-0 min-h-label b-round relative attr-b">
                        <div class="labeltype-attribute">
                          {{
                          this.getAttributeObjectById(
                          item?.get("attributeId").value
                          )?.description
                          }}
                        </div>

                        <ng-container [formGroup]="attr" *ngFor="
                                    let attr of filterAttributeForLabel(i) | sortFormArray;
                                    let z = index;
                                    trackBy: trackByFn
                                  ">
                          <ng-container *ngIf="
                                      getArrayIds(
                                        item.get('attributeValueExpression').value
                                      ).includes(attr.get('attributeId').value)
                                    ">
                            <ng-container *ngIf="
                                        !['Toggle', 'Dropdown', 'Label'].includes(
                                          getAttributeTypeObjectById(
                                            this.getAttributeObjectById(
                                              attr?.get('attributeId').value
                                            )?.attributeTypeId
                                          )?.description
                                        )
                                      ">
                              <div [ngClass]="{
                                          'width-perc-25':
                                            attr?.get('colSpace').value == 25,
                                          'width-perc-50':
                                            attr?.get('colSpace').value == 50,
                                          'width-perc-75':
                                            attr?.get('colSpace').value == 75,
                                          'width-perc-100':
                                            attr?.get('colSpace').value == 100
                                        }" class="mt-3">
                                <div class="attribute one attr-b">
                                  <label for="">
                                    {{
                                    this.getAttributeObjectById(
                                    attr?.get("attributeId").value
                                    )?.description
                                    }}</label>
                                  <div class="attribute-input">
                                    <input (change)="changeValue(attr)" type="text" formControlName="attributeValue"
                                      placeholder="Enter your value" />
                                    <mat-icon *ngIf="attr?.get('isUserInput').value" (click)="toggleLock(attr, false)"
                                      class="lock">
                                      lock
                                    </mat-icon>
                                    <mat-icon *ngIf="!attr?.get('isUserInput').value" (click)="toggleLock(attr, true)"
                                      class="lock_open">
                                      lock_open
                                    </mat-icon>
                                    <ng-container *ngIf="
                                                getAttributeTypeObjectById(
                                                  this.getAttributeObjectById(
                                                    attr?.get('attributeId').value
                                                  )?.attributeTypeId
                                                )?.availableUOMs?.length > 0
                                              ">
                                      <select tabindex="-1" *ngIf="
                                                  !['Number', 'String'].includes(
                                                    getAttributeTypeObjectById(
                                                      getAttributeObjectById(
                                                        attr?.get('attributeId').value
                                                      )?.attributeTypeId
                                                    ).description
                                                  )
                                                " formControlName="userConversionUom" id="userConversionUom">
                                        <option [value]="uom.description" *ngFor="
                                                    let uom of getAttributeTypeObjectById(
                                                      this.getAttributeObjectById(
                                                        attr?.get('attributeId').value
                                                      )?.attributeTypeId,
                                                      attr?.get('userConversionUom')
                                                    ).availableUOMs
                                                  ">
                                          {{ uom?.description }}
                                        </option>
                                      </select>
                                    </ng-container>

                                    <ng-container *ngIf="
                                                ['Number', 'String'].includes(
                                                  getAttributeTypeObjectById(
                                                    getAttributeObjectById(
                                                      attr?.get('attributeId').value
                                                    )?.attributeTypeId
                                                  ).description
                                                )
                                              ">
                                      <div class="uom-label">
                                        {{
                                        attr?.get("userConversionUom").value ?? ""
                                        }}
                                      </div>
                                    </ng-container>
                                  </div>
                                </div>
                              </div>
                            </ng-container>

                            <ng-container *ngIf="
                                        ['Toggle'].includes(
                                          getAttributeTypeObjectById(
                                            this.getAttributeObjectById(
                                              attr?.get('attributeId').value
                                            )?.attributeTypeId
                                          )?.description
                                        )
                                      ">
                              <div [ngClass]="{
                                          'width-perc-25':
                                            attr?.get('colSpace').value == 25,
                                          'width-perc-50':
                                            attr?.get('colSpace').value == 50,
                                          'width-perc-75':
                                            attr?.get('colSpace').value == 75,
                                          'width-perc-100':
                                            attr?.get('colSpace').value == 100
                                        }" class="mt-3 b-all">
                                <div class="attribute tabular-sheet attr-b">
                                  <div class="attribute-input">
                                    <input type="text" [value]="
                                                this.getAttributeObjectById(
                                                  attr?.get('attributeId').value
                                                )?.description
                                              " readonly />
                                    <mat-icon *ngIf="attr?.get('isUserInput').value" (click)="toggleLock(attr, false)"
                                      class="lock">
                                      lock
                                    </mat-icon>
                                    <mat-icon *ngIf="!attr?.get('isUserInput').value" (click)="toggleLock(attr, true)"
                                      class="lock_open">
                                      lock_open
                                    </mat-icon>
                                    <div class="toggle">
                                      <button (click)="toggleAttribute(attr, 0, i)" [ngClass]="{
                                                  active:
                                                    getArray(
                                                      attr.get('attributeValueExpression')
                                                        .value
                                                    )[0].selected == true
                                                }">
                                        {{
                                        getArray(
                                        attr.get("attributeValueExpression")
                                        .value
                                        )[0].choice
                                        }}
                                      </button>
                                      <button (click)="toggleAttribute(attr, 0, i)" [ngClass]="{
                                                  active:
                                                    getArray(
                                                      attr.get('attributeValueExpression')
                                                        .value
                                                    )[1].selected == true
                                                }">
                                        {{
                                        getArray(
                                        attr.get("attributeValueExpression")
                                        .value
                                        )[1].choice
                                        }}
                                      </button>
                                      <!-- <button >Sheet</button> -->
                                    </div>
                                  </div>
                                  <!-- <mat-icon  (click)="onDragRemoveAttribute(i1,i,m,attr)" class="cancel_outline">
                                        <img src="assets/img/icons/close.svg" alt="Close" /></mat-icon> -->
                                </div>
                              </div>
                            </ng-container>

                            <ng-container *ngIf="
                                        ['Dropdown'].includes(
                                          getAttributeTypeObjectById(
                                            this.getAttributeObjectById(
                                              attr?.get('attributeId').value
                                            )?.attributeTypeId
                                          )?.description
                                        )
                                      ">
                              <div [ngClass]="{
                                          'width-perc-25':
                                            attr?.get('colSpace').value == 25,
                                          'width-perc-50':
                                            attr?.get('colSpace').value == 50,
                                          'width-perc-75':
                                            attr?.get('colSpace').value == 75,
                                          'width-perc-100':
                                            attr?.get('colSpace').value == 100
                                        }" class="mt-3">
                                <div class="attribute one attr-b">
                                  <label for="">
                                    {{
                                    this.getAttributeObjectById(
                                    attr?.get("attributeId").value
                                    )?.description
                                    }}</label>
                                  <div class="attribute-input">
                                    <select formControlName="attributeValue" (change)="changeValue(attr)"
                                      class="width-perc-100 bg-white">
                                      <option *ngFor="
                                                  let opt of getArray(
                                                    attr.get('attributeValueExpression')
                                                      .value
                                                  )
                                                " [value]="opt.choice">
                                        {{ opt.choice }}
                                      </option>
                                    </select>
                                  </div>
                                  <!-- <mat-icon class="cancel_outline"  (click)="onDragRemoveAttribute(i1,i,m,attr)">
                                        <img src="assets/img/icons/close.svg" alt="Close" />
                                      </mat-icon> -->
                                </div>
                              </div>
                            </ng-container>
                          </ng-container>
                        </ng-container>

                        <!-- <i class="cancel_outline_new material-icon" (click)="removePackageAttribute(i, k)">
                          cancel_outline
                        </i> -->
                        <dadyin-button (click)="removePackageAttribute(i, k)" matTooltip="Delete"
                          [typeval]="'assets/nicons/delete.png'" [theme]="'borderless-primary'" type="image">
                        </dadyin-button>
                      </div>
                    </ng-container>
                  </ng-container>
                </ng-container>
              </div>
            </div>

            <div class="col-3">
              <!-- Upload - start -->


              <div (cdkDropListDropped)="onDrop($event)" cdkDropList
                class="example-list d-flex align-items-center w-100 gap-2">
                <div class="image-box-sm w-50 b-light d-flex align-items-center justify-content-center primary-text">
                  <label for="">Package Image</label>
                  <input (change)="imageselected($event)" type="file" multiple="true" style="display: none !important"
                    #fileinp accept=".jpg, .jpeg, .png" />
                  <div (click)="fileinp.click()" class="text-center cursor">
                    <mat-icon class="upload primary-text">upload</mat-icon>
                    <div class="mx-4 text-light fs-12">Upload Product Image</div>
                    <img src="assets/nicons/ai.png" class="ai-img" alt="" />
                  </div>
                </div>
                <ng-container *ngFor="
               let img of getImages(i)?.controls;
               let j = index;
             trackBy: trackByFn
         ">
                  <ng-container *ngIf="getImages(i)?.controls?.length > 0 && j === 0">
                    <div cdkDrag *ngIf="!this.isThirdPartyProductMeta || !img.get('isHide').value"
                      class="image-box-sm w-50  b-light" [ngStyle]="j === 0 ? { border: '2px solid green' } : {}">
                      <img [matTooltip]="j === 0 ? 'This will be Featured image' : ''" height="100%" width="100%"
                        [src]="imgUrl + img.get('fileName').value" alt=""
                        (click)="openImageSlider(getImages(i)?.controls, j)" />

                      <div class="cross-box-sm">
                        <dadyin-button type="image" (click)="removeImage(j, i)" [theme]="'borderless-primary'"
                          [typeval]="'assets/nicons/delete.png'"></dadyin-button>
                      </div>

                      <mat-icon (click)="hideImage(true, j)" class="hide-image-sm text-primary"
                        *ngIf="!img.get('isHide').value">visibility
                      </mat-icon>
                      <mat-icon (click)="hideImage(false, j)" class="hide-image-sm"
                        *ngIf="img.get('isHide').value">visibility_off
                      </mat-icon>
                    </div>
                  </ng-container>
                </ng-container>
              </div>

              <div class="d-flex overflow-auto gap-1">
                <ng-container *ngFor="
                    let img of getImages(i)?.controls;
                    let j = index;
                    trackBy: trackByFn
                    ">
                  <ng-container *ngIf="getImages(i)?.controls?.length > 1">
                    <div cdkDrag *ngIf="!this.isThirdPartyProductMeta || !img.get('isHide').value"
                      class="image-box-sm my-2 b-light" [ngStyle]="j === 0 ? { border: '2px solid green' } : {}">
                      <img [matTooltip]="j === 0 ? 'This will be Featured image' : ''" height="100%" width="100%"
                        [src]="imgUrl + img.get('fileName').value" alt=""
                        (click)="openImageSlider(getImages(i)?.controls, j)" />
                      <div class="cross-box-sm">
                        <dadyin-button type="image" (click)="removeImage(j)" [theme]="'borderless-primary'"
                          [typeval]="'assets/nicons/delete.png'"></dadyin-button>
                      </div>

                      <mat-icon (click)="hideImage(true, j, i)" class="hide-image-sm text-primary"
                        *ngIf="!img.get('isHide').value">visibility
                      </mat-icon>
                      <mat-icon (click)="hideImage(false, j, i)" class="hide-image-sm"
                        *ngIf="img.get('isHide').value">visibility_off
                      </mat-icon>
                    </div>
                  </ng-container>
                </ng-container>
              </div>


              <!-- Upload - end -->
            </div>




          </div>
        </div>

        <div *ngIf="
            hidePackageExpenseAndAttributes(
              packageForm.get('packageType').value
            )
          ">
          <div class="toolbar px-3 grid-10 height-40 align-items-center justify-content-between bg-light">
            <div class="title-text text-light d-flex align-items-center font-size-14">

              Package Expenses
              <mat-icon (click)="
                  toggleFlag(
                    packageForm.get('packageExpense').get('showExpenses')
                  )
                " [ngClass]="{
                  disabled: !packageForm
                    .get('packageExpense')
                    .get('showExpenses')
                }" class="text-light bg-light title-text public_icon mx-2">
                {{
                packageForm.get("packageExpense").get("showExpenses").value
                ? "visibility"
                : "visibility_off"
                }}
              </mat-icon>
              <div class="border-l-light"></div>
              <i class="material-icon mx-1 text-light border-l-light">info_outline</i>
            </div>

            <div class="d-flex align-items-center justify-content-end gap-3">
              <div class="title-text unit-value text-left text-light d-flex flex-column border-l-light"
                style="min-width: 150px;">
                <span class="text-light fw-400"> Package Expense/Unit </span>
                <span class="text-black fw-400"> $11.5</span>
              </div>
              <div class="title-text unit-value text-light d-flex flex-column border-l-light">
                <span class="text-light fw-400"> WT/Unit </span>
                <span class="text-black fw-400">5.60Kg </span>

              </div>
              <div class="title-text unit-value text-light d-flex flex-column border-l-light">
                <span class="text-light fw-400"> Weight </span>
                <span class="text-black fw-400"> {{
                  packageForm
                  .get("packageExpense")
                  .get("weight")
                  .get("attributeValue").value | numberFormatter : 3
                  }}
                  {{
                  packageForm
                  .get("packageExpense")
                  .get("weight")
                  .get("userConversionUom").value
                  }}</span>
              </div>
              <div class="title-text unit-value text-light d-flex flex-column border-l-light ">
                <span class="text-light fw-400"> Cost </span>
                <span class="text-black fw-400"> {{
                  packageForm
                  .get("packageExpense")
                  .get("cost")
                  .get("attributeValue").value | numberFormatter : 3
                  }}
                  {{
                  packageForm
                  .get("packageExpense")
                  .get("cost")
                  .get("userConversionUom").value
                  }}</span>
              </div>
            </div>

          </div>
          <div class="p-1 px-3 mx-auto b-all">
            <div class="title-text text-light attr-b mar-top-20">
              Material cost
              <dadyin-button *ngIf="getPackageExpenseValues(i)?.controls?.length == 0" (clicked)="addPackageExpense(i)"
                [typeval]="'assets/nicons/add-white.png'" [theme]="'borderless-primary'" type="image"></dadyin-button>
              <!--   <dadyin-button
                type="icon"
                typeval="add"
                *ngIf="getPackageExpenseValues(i)?.controls?.length == 0"
                (clicked)="addPackageExpense(i)"
              ></dadyin-button> -->
            </div>
            <div class="row">
              <div [formGroup]="expense" *ngFor="
                  let expense of getPackageExpenseValues(i)?.controls;
                  let k = index;
                  trackBy: trackByFn
                " class="material-cost-grid my-2">
                <div>
                  <div class="d-flex align-items-center">
                    <input formControlName="isProduct" (change)="
                        toggleProductMaterialCost(
                          $event,
                          expense.get('expenseDescription')
                        )
                      " type="checkbox" id="isProduct" />
                    <span class="mx-1 font-size-12" style="width: max-content">
                      is Product</span>
                  </div>
                </div>
                <ng-container *ngIf="expense.get('isProduct').value == true; else other">
                  <div class="">
                    <dadyin-searchable-select placeholder="Product Type" label="Product Type"
                      [control]="expense.get('productTypeId')" (changed)="onProductTypeExpenseChange(expense)"
                      [fullItems]="apiService.productTypes" bindValue="id"
                      bindLabel="description"></dadyin-searchable-select>
                  </div>
                  <div class="b-light b-round">
                    <input placeholder="Search Product Code/Description" [matAutocomplete]="auto"
                      (input)="Get_All_Product_List_IsPackage($event)"
                      [formControl]="expense.get('expenseProductCode')" />
                    <mat-autocomplete (optionSelected)="
                        onProductCodeExpenseChange($event.option.value, expense)
                      " autoActiveFirstOption #auto="matAutocomplete">
                      <mat-option [value]="item" *ngFor="let item of getFilteredProductsList(expense)">
                        {{ item.productCode }} ({{ item.description }})
                      </mat-option>
                    </mat-autocomplete>
                  </div>
                </ng-container>

                <ng-template #other>
                  <div class="">
                    <div class="attribute one">
                      <label for="">Product Type</label>
                      <div class="attribute-input">
                        <input disabled type="text" />
                      </div>
                    </div>
                  </div>
                  <div class="">
                    <div class="attribute one">
                      <label for="">Product Code</label>
                      <div class="attribute-input">
                        <input disabled type="text" />
                      </div>
                    </div>
                  </div>
                </ng-template>
                <div>
                  <div class="attribute one">
                    <label for="">Material/Product Name</label>
                    <div class="attribute-input">
                      <input [ngClass]="{
                          'b-red': expense.get('expenseDescription').invalid
                        }" formControlName="expenseDescription" [readonly]="expense.get('isProduct').value == true"
                        type="text" />
                    </div>
                  </div>
                </div>
                <div>
                  <div class="attribute one">
                    <label for="NetWtUnit">Net Wt/{{ packageForm.get("packageType").value }}</label>
                    <div class="attribute-input">
                      <input [ngClass]="{
                          'b-red': expense.get('weight').get('attributeValue')
                            .invalid
                        }" (change)="changeValue()" [formControl]="
                          expense.get('weight').get('attributeValue')
                        " type="number" min="0" placeholder="Enter your value" />
                      <select tabindex="-1" [ngClass]="{
                          'b-red': expense
                            .get('weight')
                            .get('userConversionUom').invalid
                        }" class="width-perc-75" [formControl]="
                          expense.get('weight').get('userConversionUom')
                        " id="NetWtUnit">
                        <option (change)="changeValue()" value="">
                          Select Uom
                        </option>
                        <ng-container *ngFor="
                            let item of uomService?.availableNetWeightUoms
                          ">
                          <option [value]="item.description">
                            {{ item.description }}
                          </option>
                        </ng-container>
                      </select>
                    </div>
                  </div>
                </div>
                <div class="">
                  <div class="attribute one">
                    <label for="">Cost/Unit</label>
                    <div class="attribute-input">
                      <input (change)="changeValue()" [ngClass]="{
                          'b-red': expense.get('cost').get('attributeValue')
                            .invalid
                        }" [formControl]="
                          expense.get('cost').get('attributeValue')
                        " type="number" />
                    </div>
                  </div>
                </div>
                <!--    <div>
                  <div class="attribute one">
                    <label for="CostUnit"
                      >Cost / {{ packageForm.get("packageType").value }}</label
                    >
                    <div class="attribute-input">
                      <input
                        (change)="changeValue()"
                        [ngClass]="{
                          'b-red': expense.get('cost').get('attributeValue')
                            .invalid
                        }"
                        [formControl]="
                          expense.get('cost').get('attributeValue')
                        "
                        type="number"
                        min="0"
                        placeholder="Enter your value"
                      />
                      <select
                        tabindex="-1"
                        class="width-perc-75"
                        [ngClass]="{
                          'b-red': expense.get('cost').get('userConversionUom')
                            .invalid
                        }"
                        (change)="changeValue()"
                        [formControl]="
                          expense.get('cost').get('userConversionUom')
                        "
                        id="CostUnit"
                      >
                        <option value="">Select Uom</option>
                        <ng-container
                          *ngFor="let item of uomService?.availableCostUoms"
                        >
                          <option [value]="item.description">
                            {{ item.description }}
                          </option>
                        </ng-container>
                      </select>
                    </div>
                  </div>
                </div> -->
                <div class="d-flex align-items-center">
                  <div>
                    <!--  <dadyin-button
                      [theme]="'borderless-danger'"
                      type="icon"
                      [typeval]="'delete_outline'"
                      (clicked)="removePackageExpense(i, k)"
                    ></dadyin-button> -->
                    <dadyin-button (clicked)="removePackageExpense(i, k)" matTooltip="Delete"
                      [typeval]="'assets/nicons/delete.png'" [theme]="'borderless-primary'" type="image">
                    </dadyin-button>
                  </div>
                  <div *ngIf="
                      getPackageExpenseValues(i)?.controls?.length == k + 1
                    ">
                    <dadyin-button (clicked)="addPackageExpense(i)" [typeval]="'assets/nicons/add-white.png'"
                      [theme]="'borderless-primary'" type="image"></dadyin-button>
                    <!--  <dadyin-button
                      type="icon"
                      typeval="add"
                      (clicked)="addPackageExpense(i)"
                    ></dadyin-button> -->
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="p-1 px-3 mx-auto b-all">
            <div class="title-text text-light attr-b mar-top-20">
              Conversion cost
              <dadyin-button *ngIf="getPackageExpenseConversionTypeValues(
                    i
                  )?.controls?.length == 0" (clicked)="addPackageExpenseConversionType(i)"
                [typeval]="'assets/nicons/add-white.png'" [theme]="'borderless-primary'" type="image">
              </dadyin-button>
              <!--    <dadyin-button
                type="icon"
                typeval="add"
                (clicked)="addPackageExpenseConversionType(i)"
              ></dadyin-button>   -->
            </div>
            <div class="row">
              <div class="col-6 d-flex justify-content-start" [formGroup]="packageExpenseConversionType" *ngFor="
                  let packageExpenseConversionType of getPackageExpenseConversionTypeValues(
                    i
                  )?.controls;
                  let m = index;
                  trackBy: trackByFn
                ">
                <div class="d-flex align-items-center w-100">
                  <div class="attribute one attr-b w-100">
                    <!-- <label for="">Select Conversion Type</label> -->
                    <div class="attribute-input">
                      <!-- <mat-icon class="more_vert">more_vert</mat-icon> -->
                      <select class="width-perc-100 bg-white" formControlName="conversionTypeId" id="conversionTypeId">
                        <option disabled value="null">Select Type</option>
                        <ng-container *ngFor="let item of this.apiService.conversionTypes">
                          <option [value]="item.id">
                            {{ item.description }}
                          </option>
                        </ng-container>
                      </select>
                      <input [ngClass]="{
                          'b-red': packageExpenseConversionType
                            .get('cost')
                            .get('attributeValue').invalid
                        }" (change)="changeValue()" [formControl]="
                          packageExpenseConversionType
                            .get('cost')
                            .get('attributeValue')
                        " type="number" min="0" class="bg-light" placeholder="Enter your value" />
                      <select tabindex="-1" [ngClass]="{
                          'b-red': packageExpenseConversionType
                            .get('cost')
                            .get('userConversionUom').invalid
                        }" class="width-perc-75" (change)="changeValue()" [formControl]="
                          packageExpenseConversionType
                            .get('cost')
                            .get('userConversionUom')
                        ">
                        <!-- <option disabled [value]="null" selected>Select Currency</option> -->
                        <ng-container *ngFor="let item of uomService?.availableCostUoms">
                          <option [value]="item.description">
                            {{ item.description }}
                          </option>
                        </ng-container>
                      </select>

                      <!--   <i
                        class="cancel_outline_new material-icon"
                        (click)="removePackageExpenseConversionType(i, m)"
                      >
                        cancel_outline
                      </i>  -->
                    </div>

                  </div>
                  <dadyin-button (click)="removePackageExpenseConversionType(i, m)" matTooltip="Delete"
                    [typeval]="'assets/nicons/delete.png'" [theme]="'borderless-primary'" type="image">
                  </dadyin-button>
                  <dadyin-button (clicked)="addPackageExpenseConversionType(i)"
                    [typeval]="'assets/nicons/add-white.png'" [theme]="'borderless-primary'" type="image">
                  </dadyin-button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div *ngIf="packageForm.get('packageType').value == 'PALLET'">
          <div class="toolbar px-3 bg-light grid-3">
            <div class="title-text text-light d-flex font-size-14">
              Palletisation
              <mat-icon class="text-light mx-2">visibility_off</mat-icon>
              <!-- <dadyin-button
                 (clicked)="addPalletRow(i)"
                 [typeval]="'assets/nicons/add-white.png'"
                [theme]="'borderless-primary'"
                type="image"></dadyin-button> -->
              <!--  <dadyin-button
                type="icon"
                typeval="add"
                (clicked)="addPalletRow(i)"
              ></dadyin-button> -->
            </div>
          </div>
          <div class="row package-attributes  ">
            <div class="col-3 p-2 title-text b-light my-1 font-size-12" *ngIf="getPalletRows(i)?.controls?.length > 0"
              style="border-radius: 8px;">
              <div class="d-flex ">
                <div class="col-1"></div>
                <div class="col-1"></div>
                <div class="col-2 text-center">
                  <div class="text-light">Row</div>
                </div>
                <div class="col-2 text-center">
                  <div class="text-light">Column</div>
                </div>
                <div class="col-2 text-center">
                  <div class="text-light">Total</div>
                </div>
                <div class="col-2"></div>
              </div>
              <div [formGroup]="pallet" *ngFor="
                  let pallet of getPalletRows(i)?.controls;
                  let k = index;
                  trackBy: trackByFn
                " class="d-flex">
                <div class="col-1 margin-1 d-flex flex-column justify-content-around text-center">
                  <div class="text-light">Rx</div>
                  <div class="text-light">Ry</div>
                </div>
                <div class="col-1 margin-1">
                  <div>
                    <input formControlName="rx" (change)="setRowValue(pallet, i)" type="number"
                      class="b-light w-100 margin-1" style="height: 20px !important;" />
                  </div>
                  <div>
                    <input formControlName="ry" (change)="setRowValue(pallet, i)" type="number"
                      class="b-light w-100 margin-1" style="height: 20px !important;" />
                  </div>
                </div>
                <div class="col-2 margin-1">
                  <input style="height: 100% !important" disabled formControlName="rowValue" type="number"
                    class="b-light w-100 margin-1" />
                </div>
                <div class="col-2 margin-1">
                  <input style="height: 100% !important" (change)="setTotalValue(pallet, i)"
                    formControlName="columnValue" type="number" class="b-light w-100 margin-1" />
                </div>
                <div class="col-2 margin-1">
                  <input style="height: 100% !important" disabled formControlName="total" type="number"
                    class="b-light w-100 margin-1" />
                </div>
                <div class="col-2 margin-1 my-auto">
                  <!--  <dadyin-button
                    [theme]="'borderless-danger'"
                    type="icon"
                    [typeval]="'delete_outline'"
                    (clicked)="removePalletRow(i, k)"
                  ></dadyin-button> -->
                  <dadyin-button (clicked)="removePalletRow(i, k)" matTooltip="Delete"
                    [typeval]="'assets/nicons/delete.png'" [theme]="'borderless-primary'" type="image">
                  </dadyin-button>
                  <dadyin-button *ngIf="getPalletRows(i)?.controls?.length == k + 1" (click)="addPalletRow(i)"
                    matTooltip="Add" [typeval]="'assets/nicons/add-white.png'" [theme]="'borderless-primary'"
                    type="image">
                  </dadyin-button>
                  <!-- <mat-icon
                    class="primary-text"
                    *ngIf="getPalletRows(i)?.controls?.length == k + 1"
                    (click)="addPalletRow(i)"
                    >add_circle_outline</mat-icon
                  > -->
                </div>
              </div>
            </div>
            <div class="col-3 d-flex flex-column my-1">
              <div class="attribute one attr-b">
                <label for="">SKUS/{{
                  packageForm.get("parentPackageType").value
                  }}
                  Attributes</label>
                <div class="attribute-input">
                  <input type="number" [formControl]="getSkuPerPallet(i)" placeholder="Enter your value" />
                </div>
              </div>
            </div>
            <div class="col-3 my-1"></div>
            <div class="col-3 my-1"></div>
          </div>
        </div>

        <ng-container *ngIf="
            packageForm.get('isSku').value || packages.controls?.length == i + 1
          ">
          <div class="mt-1">
            <div class="bg-light font-size-12 tab p-1">
              <div class="row p-1 mt-2 width-perc-100">
                <ng-container *ngIf="packageForm.get('isSku').value">
                  <div class="col-2">
                    <div class="attribute one">
                      <label for="">MQO (Bulk/Container)</label>
                      <div class="attribute-input">
                        <input (change)="getCalculatedValues()" [formControl]="
                            packageForm.get('packageSKUDetail').get('mqo')
                          " type="text" />
                        <div class="bg-light px-2 width-perc-20">
                          {{ packageForm.get("packageType").value }}
                        </div>
                      </div>
                    </div>
                    <div class="mx-1 mt-2">
                      <span class="text-light"> MQO Wt : </span>
                      {{
                      packageForm
                      .get("packageSKUDetail")
                      .get("mqoWeight")
                      .get("attributeValue").value | numberFormatter : 3
                      }}
                      {{
                      packageForm
                      .get("packageSKUDetail")
                      .get("mqoWeight")
                      .get("userConversionUom").value
                      }}
                    </div>
                  </div>
                  <div class="col-2">
                    <div class="attribute one">
                      <label for="" class="text-light">MQO (Custom)</label>
                      <div class="attribute-input">
                        <input (change)="getCalculatedValues()" [formControl]="
                            packageForm.get('packageSKUDetail').get('mqoCustom')
                          " type="text" />
                        <div class="bg-light px-2 width-perc-20">
                          {{ packageForm.get("packageType").value }}
                        </div>
                      </div>
                    </div>
                    <div class="mx-1 mt-2">
                      <span class="text-light"> MQO Custom Wt :</span>
                      {{
                      packageForm
                      .get("packageSKUDetail")
                      .get("mqoCustomWeight")
                      .get("attributeValue").value | numberFormatter : 3
                      }}
                      {{
                      packageForm
                      .get("packageSKUDetail")
                      .get("mqoCustomWeight")
                      .get("userConversionUom").value
                      }}
                    </div>
                  </div>
                  <div class="col-2">
                    <div class="attribute one">
                      <label for="">MQS</label>
                      <div class="attribute-input">
                        <input (change)="getCalculatedValues()" [formControl]="
                            packageForm.get('packageSKUDetail').get('mqs')
                          " type="text" placeholder="Enter your value" />
                        <div class="bg-light px-2 width-perc-20">
                          {{ packageForm.get("packageType").value }}
                        </div>
                      </div>
                    </div>
                    <div class="mx-1 mt-2">
                      MQS Wt :
                      {{
                      packageForm
                      .get("packageSKUDetail")
                      .get("mqsWeight")
                      .get("attributeValue").value | numberFormatter : 3
                      }}
                      {{
                      packageForm
                      .get("packageSKUDetail")
                      .get("mqsWeight")
                      .get("userConversionUom").value
                      }}
                    </div>
                  </div>
                  <div class="col-2">
                    <div>
                      <div class="attribute tabular-sheet attr-b">
                        <div class="attribute-input">
                          <div class="mx-2">Stackable</div>
                          <div class="toggle bg-white">
                            <button (click)="
                                packageForm
                                  .get('packageSKUDetail')
                                  .get('isStackable')
                                  .setValue(true)
                              " [ngClass]="{
                                active:
                                  packageForm
                                    .get('packageSKUDetail')
                                    .get('isStackable').value == true
                              }">
                              Yes
                            </button>
                            <button (click)="
                                packageForm
                                  .get('packageSKUDetail')
                                  .get('isStackable')
                                  .setValue(false)
                              " [ngClass]="{
                                active:
                                  packageForm
                                    .get('packageSKUDetail')
                                    .get('isStackable').value == false
                              }">
                              No
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </ng-container>
                <ng-container *ngIf="!packageForm.get('isSku').value">
                  <div class="col-8"></div>
                </ng-container>

                <div class="col-4 justify-content-end d-flex align-items-end flex-column"
                  *ngIf="packages.controls?.length == i + 1">

                  <dadyin-button class="text-right mx-2" (clicked)="addPackage()" label="Add New Package"
                    [theme]="'primary'">
                  </dadyin-button>
                  <div class="mt-1 title-text text-light text-end font-size-12">
                    Only add packages which are excluded
                  </div>
                </div>
              </div>
            </div>
          </div>
        </ng-container>
      </mat-expansion-panel>
    </ng-container>
  </ng-container>
</div>